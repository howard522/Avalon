name: Build & Deploy Flutter Web

# è§¦å‘æ¡ä»¶ï¼šæ¯æ¬¡ push åˆ° main åˆ†æ”¯ï¼Œæˆ– PR åˆå¹¶åˆ° main
on:
  push:
    branches:
      - main

jobs:
  build-and-deploy:
    # é€‰æ‹©æ‰§è¡Œç¯å¢ƒ
    runs-on: ubuntu-latest

    steps:
      # 1. ç­¾å‡ºä½ ä»“åº“é‡Œçš„æ‰€æœ‰ä»£ç 
      - uses: actions/checkout@v3

      # 2. è®¾ç½® Flutter SDKï¼ˆä½¿ç”¨ subosito/flutter-actionï¼‰
      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: 'stable'   # ä¹Ÿå¯æŒ‡å®š '3.7.0'ã€'3.10.5' ç­‰

      # 3. å®‰è£…ä¾èµ–
      - name: Install dependencies
        run: flutter pub get

      # 4. è¿è¡Œé™æ€ä»£ç åˆ†æï¼ˆå¯é€‰ï¼‰
      - name: Analyze code
        run: flutter analyze

      # 5. è¿è¡Œæµ‹è¯•ï¼ˆå¯é€‰ï¼‰
      - name: Run tests
        run: flutter test --coverage

      # 6. æ„å»º Web ç‰ˆæœ¬
      - name: Build Web
        run: flutter build web --release

      # 7. éƒ¨ç½²åˆ° GitHub Pagesï¼ˆä½¿ç”¨ peaceiris/actions-gh-pagesï¼‰
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          # æŒ‡å®šè¦å‘å¸ƒçš„ç›®å½•
          publish_dir: build/web
          # å‘å¸ƒåˆ° gh-pages åˆ†æ”¯
          publish_branch: gh-pages
          # å¯é€‰ï¼šè‡ªå®šä¹‰ commit ä¿¡æ¯
          commit_message: "ğŸš€ Deploy Flutter Web to GitHub Pages"
